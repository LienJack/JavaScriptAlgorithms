<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>KMP</title>
</head>
<body>
<script>
    function calNext(str, len, next) {
        let i = 0,
            j = -1;
        next[0] = -1;
        while (i < len) {
            if (j === -1 || str[j] === str[i]) {
                next[++i] = ++j;
            } else {
                j = next[j];
            }
        }
    };

    function kmp(str, pstr) {
        let slen = str.length,
            plen = pstr.length,
            i = 0,
            j = 0,
            next = new Array(plen),
            res = [];
        calNext(pstr, plen, next);
        while (i < slen && j < plen) {
            if (j === -1 || str[i] === pstr[j]) {
                i++;
                j++;
            } else {
                j = next[j];
            }
            if (j === plen) {
                res.push(i - j);
                j = 0
            }
        }
        return res.length ? res : 0
    }

    console.log(kmp("bacbababadababacambabacaddababacasdsd", "ababaca"))
</script>
</body>
</html>